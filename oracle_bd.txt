
CREATE TABLE producto(    
    id_producto INTEGER generated by default as identity primary key,
    nombre varchar(400) not null,
    descripcion varchar (400) not null,
    palab_clave varchar (400) not null,
    precio NUMBER(8,2) not null,
    ruta varchar(400) not null,
    nom_cat varchar(400) not null,    
    id_c integer not null,
    estado_detele integer default 1
);

CREATE TABLE categoria(    
    nombre varchar(400) not null primary key,
    id_ad integer not null
);

CREATE TABLE cliente(    
    id_c INTEGER generated by default as identity primary key,
    nombre varchar(400) not null,
    apellido varchar (400) not null,
    correo varchar (400) not null,
    pais varchar(400) not null,
    fech_nac varchar(400) not null,
    pass varchar(400) not null,
    image varchar(1000) not null,
    creditos integer not null, /*Posiblemente cambiar a decimal*/
    confirmacion integer not null
);

CREATE TABLE administrador(    
    id_ad INTEGER generated by default as identity primary key,
    nombre varchar(400) not null,
    apellido varchar (400) not null,
    correo varchar (400) not null,
    pais varchar(400) not null,
    fech_nac varchar(400) not null,
    pass varchar(400) not null,
    image varchar(1000) not null
);

CREATE TABLE reaccion(
    id_reaccion INTEGER generated by default as identity primary key,
    megusta integer not null,
    nomegusta integer not null,
    id_producto integer not null,
    id_c integer not null
);

CREATE TABLE detalle_cv(
    id_dcv INTEGER generated by default as identity primary key,
    cantidad integer not null,
    precio NUMBER(8,2) not null,
    subtotal integer not null,
    id_producto integer not null,
    id_c integer not null
);

CREATE TABLE comentario(
    id_com INTEGER generated by default as identity primary key,
    descripcion varchar(2000) not null,
    fecha varchar(400) not null,
    id_producto integer not null,
    id_c integer not null
);

CREATE TABLE denuncia(
    id_den INTEGER generated by default as identity primary key,
    descripcion varchar(2000) not null,
    fecha varchar(400) not null,
    estado_detele integer default 1,
    id_producto integer not null,
    id_c integer not null
);

CREATE TABLE bitacora(
    id_bit INTEGER generated by default as identity primary key,
    correo varchar(400) not null,
    descripcion varchar(400) not null,
    fecha varchar(400) not null
);

COMMIT;

/*FORANEAS*/
alter table categoria
add constraint FK_categoria_administrador
foreign key (id_ad)
references administrador (id_ad);

alter table producto
add constraint FK_producto_categoria
foreign key (nom_cat)
references categoria (nombre);

alter table reaccion
add constraint FK_reaccion_producto
foreign key (id_producto)
references producto (id_producto);

alter table reaccion
add constraint FK_reaccion_cliente
foreign key (id_c)
references cliente (id_c);

alter table detalle_cv
add constraint FK_detalle_cv_producto
foreign key (id_producto)
references producto (id_producto);

alter table detalle_cv
add constraint FK_detalle_cv_cliente
foreign key (id_c)
references cliente (id_c);

alter table comentario
add constraint FK_comentario_producto
foreign key (id_producto)
references producto (id_producto);

alter table comentario
add constraint FK_comentario_cliente
foreign key (id_c)
references cliente (id_c);

alter table denuncia
add constraint FK_denuncia_producto
foreign key (id_producto)
references producto (id_producto);

alter table denuncia
add constraint FK_denuncia_cliente
foreign key (id_c)
references cliente (id_c);

/*drop table producto;
drop table cliente;*/


delete from producto where id_producto=128;

insert into administrador(nombre,apellido,correo,pais,fech_nac,pass,image) values('Christopher','Gudiel','admin@gmail.com','Guatemala','1990-01-01','admin','https://res.cloudinary.com/gudiel16/image/upload/v1603448091/testing_angular_cloudinary/mbal9b2dpdar125yqshe.jpg');

insert into producto(nombre,descripcion,palab_clave,precio,ruta,nom_cat,id_c) values ('Huawei p40','Fallo en camara','negro,barato',2000,'pathImage','Celulares',1);
insert into producto(nombre,descripcion,palab_clave,precio,ruta,nom_cat,id_c) values ('Huawei p30','Fallo en touch','negro,barato',3000.50,'pathImage','Celulares',1);
insert into producto(nombre,descripcion,palab_clave,precio,ruta,nom_cat,id_c) values ('Huawei p10','Para repuestos','negro,barato',1000,'pathImage','Celulares',1);
insert into producto(nombre,descripcion,palab_clave,precio,ruta,nom_cat,id_c) values ('Samsun s10','Para repuestos','negro,barato',1010,'pathImage','Celulares',1);

insert into categoria(nombre,id_ad) values ('Celulares',1);

insert into detalle_cv(cantidad,precio,subtotal,id_producto,id_c) values (cantidad,precio,subtotal,id_producto,id_c);

insert into comentario(descripcion,fecha,id_producto,id_c) values(descripcion,fecha,id_producto,id_c);
select * from comentario;

insert into denuncia(descripcion,fecha,id_producto,id_c) values(descripcion,fecha,id_producto,id_c);

insert into bitacora(correo,descripcion,fecha) values(correo,descripcion,fecha);

update cliente set confirmacion=0 where correo='prueba@gmail.com' and pass='123';
update cliente set nombre='a', apellido='b', pais='c', fech_nac='d', pass='e', image='f' where id_c=21;
update administrador set nombre='a', apellido='b', pais='c', fech_nac='d', pass='e', image='f' where id_ad=1;

COMMIT;

select * from producto where id_producto=1;
select id_c, nombre, apellido, correo, pais, fech_nac, pass, image, creditos, confirmacion from cliente where correo='cg@gmail.com' and pass='12' and confirmacion=1;

/*retornar correo*/
select correo,nombre,creditos from cliente where id_c=24;
/*rec pass*/
select id_c, nombre, apellido, correo, pais, fech_nac, pass, image, creditos, confirmacion from cliente where correo='prueba@gmail.com';
/*update pass*/
update cliente set pass='aaa' where id_c=2;
/*Productos ASC DESC*/
select * from producto order by precio asc;
select * from producto order by precio desc;
/*Buscar Palabra Clave*/
select id_producto,nombre,descripcion, palab_clave,precio,nom_cat,id_c, instr(palab_clave,'negro',1,1) from producto where instr(palab_clave,'negro',1,1)=1;
/*Por categoria*/
select * from producto where nom_cat='Celulares';
/*actualizar creditos*/
update cliente set creditos=10000 where id_c=62;
COMMIT;

/*PARA REACCION*/
insert into reaccion(megusta,nomegusta,id_producto,id_c) values(1,0,123,1);
insert into reaccion(megusta,nomegusta,id_producto,id_c) values(1,0,123,2);
insert into reaccion(megusta,nomegusta,id_producto,id_c) values(1,0,123,3);
insert into reaccion(megusta,nomegusta,id_producto,id_c) values(1,0,123,24);
insert into reaccion(megusta,nomegusta,id_producto,id_c) values(1,0,124,24);

/*obtener cantidad de megusta del producto*/
select count(megusta) as "megusta" from reaccion where id_producto=123 and megusta=1;

/*obtener cantidad de nomegusta del producto*/
select count(nomegusta) as "nomegusta" from reaccion where id_producto=123 and nomegusta=1;

/*verificar si el usuario ya esta en la tabla reaccion, con ese producto*/
select * from reaccion where id_c=24 and id_producto =123;

/*verificar si el usuario ya le dio megusta*/
select * from reaccion where id_c=24 and id_producto=123 and megusta=1;

/*verificar si el usuario ya le dio nomegusta*/
select * from reaccion where id_c=24 and id_producto=123 and nomegusta=1;

/* de megusta->nomegusta*/
update reaccion set megusta=0, nomegusta=1 where id_c=24 and id_producto=123;

/* de nomegusta->megusta*/
update reaccion set megusta=1, nomegusta=0 where id_c=1 and id_producto=123;

select * from producto;
select * from cliente;
select * from administrador;
select * from producto where producto.estado_detele=1;
select nombre from categoria;
select * from reaccion;
select * from detalle_cv;
select CONCAT(CONCAT(cliente.nombre, ' '), cliente.apellido) "nombre", cliente.image, comentario.descripcion, comentario.fecha from comentario,cliente where cliente.id_c=comentario.id_c and comentario.id_producto=123 order by comentario.id_com asc;
select * from denuncia;
select * from bitacora order by id_bit asc;

/*mostrar todas las denuncias*/
select producto.nombre,producto.descripcion as "DESCRIPRODUC",producto.nom_cat,producto.precio,producto.ruta,denuncia.descripcion,denuncia.fecha,denuncia.id_producto
from producto,denuncia
where producto.id_producto=denuncia.id_producto and denuncia.estado_detele=1
order by denuncia.id_den asc;

/*productos bloqueados*/
select producto.nombre,producto.descripcion as "DESCRIPRODUC",producto.nom_cat,producto.precio,producto.ruta,denuncia.descripcion,denuncia.fecha,denuncia.id_producto
from producto,denuncia
where producto.id_producto=denuncia.id_producto and denuncia.estado_detele=0
order by denuncia.id_den asc;

/*eliminar producto*/
update producto set estado_detele=0 where id_producto=6;

/*elimina todas las denuncias con ese producto*/
update denuncia set estado_detele=0 where id_producto=6;


drop table comentario;
drop table denuncia;
drop table detalle_cv;
drop table reaccion;
drop table producto;

delete from producto where id_producto=126;
delete from cliente where id_c=21;
delete from cliente where id_c=22;
delete from cliente where id_c=61;

COMMIT;








